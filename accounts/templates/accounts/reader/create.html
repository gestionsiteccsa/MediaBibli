{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Créer un lecteur" %} - MediaBiB{% endblock %}

{% block content %}
<h1>{% trans "Créer un lecteur" %}</h1>

{% if libraries %}
<form method="get">
    <label for="library">{% trans "Médiathèque" %}</label>
    <select name="library" id="library" onchange="this.form.submit()">
        <option value="">-- {% trans "Sélectionner une médiathèque" %} --</option>
        {% for lib in libraries %}
        <option value="{{ lib.pk }}" {% if library and library.pk == lib.pk %}selected{% endif %}>{{ lib.name }}</option>
        {% endfor %}
    </select>
</form>
{% endif %}

{% if library or not libraries %}
<p>{% trans "Médiathèque" %}: <strong>{{ library.name }}</strong></p>

<form method="post">
    {% csrf_token %}
    {% if libraries %}<input type="hidden" name="library" value="{{ library.pk }}">{% endif %}

    <fieldset>
        <legend>{% trans "Compte utilisateur" %}</legend>

        <div>
            <label for="id_username">{% trans "Nom d'utilisateur" %}</label>
            <input type="text" name="username" id="id_username" value="{{ form.username.value|default:'' }}" required>
            {% if form.username.errors %}<span>{{ form.username.errors.0 }}</span>{% endif %}
        </div>

        <div>
            <label for="id_email">{% trans "Email" %}</label>
            <input type="email" name="email" id="id_email" value="{{ form.email.value|default:'' }}">
            {% if form.email.errors %}<span>{{ form.email.errors.0 }}</span>{% endif %}
        </div>

        <div>
            <label for="id_first_name">{% trans "Prénom" %}</label>
            <input type="text" name="first_name" id="id_first_name" value="{{ form.first_name.value|default:'' }}" required>
            {% if form.first_name.errors %}<span>{{ form.first_name.errors.0 }}</span>{% endif %}
        </div>

        <div>
            <label for="id_last_name">{% trans "Nom" %}</label>
            <input type="text" name="last_name" id="id_last_name" value="{{ form.last_name.value|default:'' }}" required>
            {% if form.last_name.errors %}<span>{{ form.last_name.errors.0 }}</span>{% endif %}
        </div>
    </fieldset>

    <fieldset>
        <legend>{% trans "Informations lecteur" %}</legend>

        {% for field in form %}
            {% if field.name not in 'username,email,first_name,last_name,send_password_email' %}
            <div>
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                {{ field }}
                {% if field.help_text %}<small>{{ field.help_text }}</small>{% endif %}
                {% if field.errors %}<span>{{ field.errors.0 }}</span>{% endif %}
            </div>
            {% endif %}
        {% endfor %}
    </fieldset>

    <fieldset>
        <legend>{% trans "Options" %}</legend>
        <div>
            <label>
                <input type="checkbox" name="send_password_email" {% if form.send_password_email.value %}checked{% endif %}>
                {% trans "Envoyer le mot de passe par email" %}
            </label>
            <small>{% trans "L'email doit être renseigné pour cette option." %}</small>
        </div>
    </fieldset>

    <div>
        <button type="submit">{% trans "Créer le lecteur" %}</button>
        <a href="{% url 'accounts:reader_list' %}">{% trans "Annuler" %}</a>
    </div>
</form>
{% else %}
<p>{% trans "Veuillez d'abord sélectionner une médiathèque." %}</p>
{% endif %}
{% endblock %}
